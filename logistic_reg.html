<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="May" />


<title>Logistic Regression</title>

<script src="logistic_reg_files/header-attrs-2.1/header-attrs.js"></script>
<script src="logistic_reg_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="logistic_reg_files/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="logistic_reg_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="logistic_reg_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="logistic_reg_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="logistic_reg_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="logistic_reg_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="logistic_reg_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="logistic_reg_files/navigation-1.1/tabsets.js"></script>
<link href="logistic_reg_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="logistic_reg_files/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Logistic Regression</h1>
<h4 class="author">May</h4>

</div>


<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div id="myocardial-infarction" class="section level1">
<h1>Myocardial Infarction</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mi_df <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&quot;datasets/MI_PracticeDataset.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mi_df)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["num1"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Sex"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Age"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SteadyPartner"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["RelIncome"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Work_prior"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Work_T5"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Work_T4"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Education"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["Neighborhood"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["PerceivHealth"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["Health_Prob"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["HTN"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["Diabetes"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["cursmoker"],"name":[15],"type":["dbl"],"align":["right"]},{"label":["formersmoker"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["T1_pa"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["T2_pa"],"name":[18],"type":["dbl"],"align":["right"]},{"label":["T3_pa"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["T4_pa"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["T5_pa"],"name":[21],"type":["dbl"],"align":["right"]},{"label":["tm2T2_n"],"name":[22],"type":["dbl"],"align":["right"]},{"label":["tm2T3_n"],"name":[23],"type":["dbl"],"align":["right"]},{"label":["tm2T4_n"],"name":[24],"type":["dbl"],"align":["right"]},{"label":["tm2T5_n"],"name":[25],"type":["dbl"],"align":["right"]},{"label":["ethnicity"],"name":[26],"type":["dbl"],"align":["right"]},{"label":["death_update"],"name":[27],"type":["dbl"],"align":["right"]},{"label":["tm2death_update"],"name":[28],"type":["dbl"],"align":["right"]},{"label":["bmi1"],"name":[29],"type":["dbl"],"align":["right"]},{"label":["bmi3"],"name":[30],"type":["dbl"],"align":["right"]},{"label":["bmi4"],"name":[31],"type":["dbl"],"align":["right"]},{"label":["bmi5"],"name":[32],"type":["dbl"],"align":["right"]},{"label":["CVDeath_2012"],"name":[33],"type":["dbl"],"align":["right"]},{"label":["nonCVDeath_2012"],"name":[34],"type":["dbl"],"align":["right"]}],"data":[{"1":"1001","2":"1","3":"52","4":"1","5":"3","6":"1","7":"1","8":"1","9":"18","10":"17","11":"4","12":"0","13":"0","14":"0","15":"0","16":"1","17":"3","18":"2","19":"3","20":"3","21":"2","22":"135","23":"540","24":"1888","25":"4000","26":"0","27":"0","28":"5068","29":"29.91362","30":"28.99789","31":"31.13458","32":"31.43982","33":"0","34":"0"},{"1":"1002","2":"1","3":"60","4":"1","5":"1","6":"1","7":"2","8":"0","9":"0","10":"11","11":"2","12":"4","13":"1","14":"1","15":"1","16":"0","17":"0","18":"2","19":"0","20":"0","21":"1","22":"135","23":"540","24":"1985","25":"4200","26":"1","27":"1","28":"2880","29":"28.02768","30":"25.95156","31":"27.68166","32":"-1.00000","33":"0","34":"1"},{"1":"1003","2":"1","3":"51","4":"1","5":"3","6":"1","7":"1","8":"1","9":"14","10":"19","11":"4","12":"0","13":"0","14":"0","15":"0","16":"0","17":"2","18":"3","19":"0","20":"2","21":"3","22":"135","23":"540","24":"1905","25":"3971","26":"3","27":"0","28":"7226","29":"24.80159","30":"25.86451","31":"25.86451","32":"26.57313","33":"0","34":"0"},{"1":"1004","2":"1","3":"62","4":"1","5":"1","6":"1","7":"0","8":"1","9":"12","10":"12","11":"3","12":"2","13":"0","14":"0","15":"0","16":"1","17":"0","18":"0","19":"0","20":"3","21":"3","22":"135","23":"540","24":"1915","25":"4000","26":"1","27":"0","28":"7226","29":"26.49303","30":"26.49303","31":"23.62029","32":"26.81222","33":"0","34":"0"},{"1":"1005","2":"1","3":"55","4":"1","5":"3","6":"1","7":"1","8":"1","9":"16","10":"17","11":"5","12":"2","13":"1","14":"0","15":"0","16":"0","17":"3","18":"3","19":"3","20":"3","21":"3","22":"135","23":"540","24":"1883","25":"3990","26":"0","27":"0","28":"7223","29":"24.75546","30":"23.84978","31":"25.05736","32":"25.66115","33":"0","34":"0"},{"1":"1006","2":"1","3":"49","4":"1","5":"3","6":"1","7":"1","8":"1","9":"20","10":"19","11":"4","12":"0","13":"0","14":"0","15":"0","16":"0","17":"2","18":"3","19":"3","20":"3","21":"3","22":"135","23":"540","24":"1868","25":"4000","26":"3","27":"0","28":"7217","29":"24.50895","30":"24.50895","31":"24.50895","32":"26.95984","33":"0","34":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Format:</p>
<ul>
<li><code>sex</code> - 1- male , 2- female</li>
<li><code>SteadyPartner</code> - Living with steady partner (0 - No, 1- Yes)</li>
<li><code>RelIncome</code> - 1- Lower; 2- Similar; 3- Higher; 9-Refuse to tell</li>
<li><code>PerceivHealth</code> - 1- Poor; 2- Not so good; 3- Fair; 4-Good; 5- Excellent</li>
<li><code>Health_Prob</code> - Number of health problems</li>
<li><code>Work_T5</code> / <code>Work_T4</code> - Employment status reported during follow-up interviews (0- None; 1- Part/full job; 2- Unknown)</li>
<li><code>T1_pa</code> / <code>T2_pa</code> / <code>T3_pa</code> / <code>T4_pa</code> /<code>T5_pa</code> - Physical activity level reported in the i-th interview. Ta_p1 - refers to the activity a before myocardial infarction.</li>
<li><code>cursmoker</code> - Smoking as reported in the first interview - as stated at the time of hospitalization, refers to the smoking status in the year preceding the infarction.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mi_df)</span></code></pre></div>
<pre><code>## Classes &#39;spec_tbl_df&#39;, &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 1521 obs. of  34 variables:
##  $ num1           : num  1001 1002 1003 1004 1005 ...
##  $ Sex            : num  1 1 1 1 1 1 1 1 2 1 ...
##  $ Age            : num  52 60 51 62 55 49 45 56 57 57 ...
##  $ SteadyPartner  : num  1 1 1 1 1 1 0 0 1 1 ...
##  $ RelIncome      : num  3 1 3 1 3 3 3 1 1 3 ...
##  $ Work_prior     : num  1 1 1 1 1 1 1 0 0 1 ...
##  $ Work_T5        : num  1 2 1 0 1 1 1 0 0 1 ...
##  $ Work_T4        : num  1 0 1 1 1 1 1 0 0 1 ...
##  $ Education      : num  18 0 14 12 16 20 20 10 6 16 ...
##  $ Neighborhood   : num  17 11 19 12 17 19 19 NA 5 17 ...
##  $ PerceivHealth  : num  4 2 4 3 5 4 5 1 2 5 ...
##  $ Health_Prob    : num  0 4 0 2 2 0 1 1 3 4 ...
##  $ HTN            : num  0 1 0 0 1 0 0 0 1 1 ...
##  $ Diabetes       : num  0 1 0 0 0 0 0 0 0 0 ...
##  $ cursmoker      : num  0 1 0 0 0 0 0 1 1 0 ...
##  $ formersmoker   : num  1 0 0 1 0 0 1 0 0 1 ...
##  $ T1_pa          : num  3 0 2 0 3 2 2 0 3 0 ...
##  $ T2_pa          : num  2 2 3 0 3 3 3 3 0 3 ...
##  $ T3_pa          : num  3 0 0 0 3 3 3 0 0 3 ...
##  $ T4_pa          : num  3 0 2 3 3 3 3 0 3 3 ...
##  $ T5_pa          : num  2 1 3 3 3 3 3 0 3 3 ...
##  $ tm2T2_n        : num  135 135 135 135 135 135 135 135 135 135 ...
##  $ tm2T3_n        : num  540 540 540 540 540 540 540 540 540 540 ...
##  $ tm2T4_n        : num  1888 1985 1905 1915 1883 ...
##  $ tm2T5_n        : num  4000 4200 3971 4000 3990 ...
##  $ ethnicity      : num  0 1 3 1 0 3 3 0 1 3 ...
##  $ death_update   : num  0 1 0 0 0 0 0 1 0 0 ...
##  $ tm2death_update: num  5068 2880 7226 7226 7223 ...
##  $ bmi1           : num  29.9 28 24.8 26.5 24.8 ...
##  $ bmi3           : num  29 26 25.9 26.5 23.8 ...
##  $ bmi4           : num  31.1 27.7 25.9 23.6 25.1 ...
##  $ bmi5           : num  31.4 -1 26.6 26.8 25.7 ...
##  $ CVDeath_2012   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ nonCVDeath_2012: num  0 1 0 0 0 0 0 1 0 0 ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   num1 = col_double(),
##   ..   Sex = col_double(),
##   ..   Age = col_double(),
##   ..   SteadyPartner = col_double(),
##   ..   RelIncome = col_double(),
##   ..   Work_prior = col_double(),
##   ..   Work_T5 = col_double(),
##   ..   Work_T4 = col_double(),
##   ..   Education = col_double(),
##   ..   Neighborhood = col_double(),
##   ..   PerceivHealth = col_double(),
##   ..   Health_Prob = col_double(),
##   ..   HTN = col_double(),
##   ..   Diabetes = col_double(),
##   ..   cursmoker = col_double(),
##   ..   formersmoker = col_double(),
##   ..   T1_pa = col_double(),
##   ..   T2_pa = col_double(),
##   ..   T3_pa = col_double(),
##   ..   T4_pa = col_double(),
##   ..   T5_pa = col_double(),
##   ..   tm2T2_n = col_double(),
##   ..   tm2T3_n = col_double(),
##   ..   tm2T4_n = col_double(),
##   ..   tm2T5_n = col_double(),
##   ..   ethnicity = col_double(),
##   ..   death_update = col_double(),
##   ..   tm2death_update = col_double(),
##   ..   bmi1 = col_double(),
##   ..   bmi3 = col_double(),
##   ..   bmi4 = col_double(),
##   ..   bmi5 = col_double(),
##   ..   CVDeath_2012 = col_double(),
##   ..   nonCVDeath_2012 = col_double()
##   .. )</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mi_df)</span></code></pre></div>
<pre><code>## [1] 1521   34</code></pre>
<p>NA’s?</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sum_is_na <span class="ot">=</span> <span class="cf">function</span>(col) <span class="fu">return</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(col)))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mi_df, <span class="dv">2</span>, sum_is_na)</span></code></pre></div>
<pre><code>##            num1             Sex             Age   SteadyPartner       RelIncome 
##               0               0               0               0               0 
##      Work_prior         Work_T5         Work_T4       Education    Neighborhood 
##               0               0               0               0             111 
##   PerceivHealth     Health_Prob             HTN        Diabetes       cursmoker 
##               0               0               0               0               0 
##    formersmoker           T1_pa           T2_pa           T3_pa           T4_pa 
##               0               0               0               0               0 
##           T5_pa         tm2T2_n         tm2T3_n         tm2T4_n         tm2T5_n 
##               0               0               0               0               0 
##       ethnicity    death_update tm2death_update            bmi1            bmi3 
##               0               0               0               0               0 
##            bmi4            bmi5    CVDeath_2012 nonCVDeath_2012 
##               0               0               0               0</code></pre>
<div id="descriptive-statistics" class="section level2">
<h2>Descriptive Statistics</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(Sex ))</span></code></pre></div>
<pre><code>## Sex
##    1    2 
## 1232  289</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(PerceivHealth ))</span></code></pre></div>
<pre><code>## PerceivHealth
##   1   2   3   4   5 
##  55 234 346 570 316</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(PerceivHealth, death_update ))</span></code></pre></div>
<pre><code>##              death_update
## PerceivHealth   0   1
##             1  17  38
##             2  95 139
##             3 173 173
##             4 376 194
##             5 221  95</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(RelIncome ))</span></code></pre></div>
<pre><code>## RelIncome
##   0   1   2   3   9 
## 247 593 351 319  11</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(formersmoker ))</span></code></pre></div>
<pre><code>## formersmoker
##    0    1 
## 1216  305</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(CVDeath_2012, death_update))</span></code></pre></div>
<pre><code>##             death_update
## CVDeath_2012   0   1
##            0 861 349
##            1  21 290</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">prop.table</span>(<span class="fu">table</span>(Sex, death_update)))</span></code></pre></div>
<pre><code>##    death_update
## Sex          0          1
##   1 0.48586456 0.32412886
##   2 0.09401709 0.09598948</code></pre>
</div>
<div id="logistic-regression" class="section level2">
<h2>Logistic Regression</h2>
<div id="one-variable-continuous-or-categorical" class="section level3">
<h3>One variable (continuous or categorical)</h3>
<div id="x-formersmoker" class="section level4">
<h4>X = formersmoker</h4>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>( formersmoker, death_update))</span></code></pre></div>
<pre><code>##             death_update
## formersmoker   0   1
##            0 688 528
##            1 194 111</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">prop.table</span>(<span class="fu">table</span>( formersmoker, death_update)))</span></code></pre></div>
<pre><code>##             death_update
## formersmoker         0         1
##            0 0.4523340 0.3471400
##            1 0.1275477 0.0729783</code></pre>
<p>OR: <span class="math inline">\(\frac{688\cdot111}{528\cdot111} =0.7455\)</span></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">glm</span>(death_update <span class="sc">~</span> formersmoker  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ formersmoker, family = &quot;binomial&quot;, 
##     data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.0673  -1.0673  -0.9513   1.2917   1.4218  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -0.26469    0.05786  -4.575 4.76e-06 ***
## formersmoker -0.29364    0.13233  -2.219   0.0265 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 2064.6  on 1519  degrees of freedom
## AIC: 2068.6
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OR</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(fit<span class="fl">.1</span>)[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## formersmoker 
##    0.7455483</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wald confidence interval of b1:</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint.default</span>(fit<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>##                   2.5 %      97.5 %
## (Intercept)  -0.3780901 -0.15129500
## formersmoker -0.5529963 -0.03427451</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># manualy</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># option 1 </span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>cont <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>var_b1 <span class="ot">=</span> <span class="fu">as.numeric</span> ( <span class="fu">t</span>(cont) <span class="sc">%*%</span> <span class="fu">vcov</span>(fit<span class="fl">.1</span>) <span class="sc">%*%</span> cont)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">=</span> <span class="fu">coef</span>(fit<span class="fl">.1</span>)[<span class="dv">2</span>]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>ci_b1 <span class="ot">=</span> b1 <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(var_b1)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>ci_b1</span></code></pre></div>
<pre><code>## [1] -0.55299629 -0.03427451</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># option 2 </span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>b1 <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">summary</span>(fit<span class="fl">.1</span>)<span class="sc">$</span>coefficient[<span class="dv">2</span>,<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] -0.55299629 -0.03427451</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ci for OR = exp(b1):</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(ci_b1)</span></code></pre></div>
<pre><code>## [1] 0.5752237 0.9663062</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ci for probability of death when x=1 (formersmokre=1)</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">=</span> <span class="fu">as.numeric</span>( <span class="fu">coef</span>(fit<span class="fl">.1</span>)[<span class="dv">1</span>] ) </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">=</span><span class="fu">as.numeric</span>( <span class="fu">coef</span>(fit<span class="fl">.1</span>)[<span class="dv">2</span>] )</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>contr <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>var_cbeta <span class="ot">=</span> <span class="fu">t</span>(contr) <span class="sc">%*%</span> <span class="fu">vcov</span> (fit<span class="fl">.1</span>) <span class="sc">%*%</span> contr</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">coef</span>(fit<span class="fl">.1</span>)) </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>ci_lp <span class="ot">=</span> <span class="fu">as.numeric</span>( contr <span class="sc">%*%</span> beta_hat)  <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> <span class="fu">qnorm</span>(.<span class="dv">975</span>) <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>( var_cbeta))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;CI of beta0+beta1:&quot;</span>, ci_lp[<span class="dv">1</span>], ci_lp[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## CI of beta0+beta1: -0.7915855 -0.3250704</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>logit_fun <span class="ot">=</span> <span class="cf">function</span>(x) <span class="fu">return</span>(<span class="fu">exp</span>(x)<span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(x)))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>ci_p <span class="ot">=</span>  <span class="fu">logit_fun</span>(ci_lp)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;CI of the probability of mortality for a formersmoker (X=1):&quot;</span>, ci_p[<span class="dv">1</span>], ci_p[<span class="dv">2</span>] )</span></code></pre></div>
<pre><code>## CI of the probability of mortality for a formersmoker (X=1): 0.3118283 0.4194405</code></pre>
</div>
<div id="x-sex" class="section level4">
<h4>X = Sex</h4>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(Sex , death_update))</span></code></pre></div>
<pre><code>##    death_update
## Sex   0   1
##   1 739 493
##   2 143 146</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">prop.table</span>(<span class="fu">table</span>(Sex , death_update)))</span></code></pre></div>
<pre><code>##    death_update
## Sex          0          1
##   1 0.48586456 0.32412886
##   2 0.09401709 0.09598948</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.2</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> <span class="fu">factor</span>(Sex)  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ factor(Sex), family = &quot;binomial&quot;, 
##     data = mi_df)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.186  -1.011  -1.011   1.353   1.353  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -0.40479    0.05815  -6.961 3.38e-12 ***
## factor(Sex)2  0.42555    0.13124   3.243  0.00118 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 2059.1  on 1519  degrees of freedom
## AIC: 2063.1
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="x-diabetes" class="section level4">
<h4>X = Diabetes</h4>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(Diabetes , death_update))</span></code></pre></div>
<pre><code>##         death_update
## Diabetes   0   1
##        0 736 412
##        1 146 227</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">prop.table</span>(<span class="fu">table</span>(Diabetes , death_update)))</span></code></pre></div>
<pre><code>##         death_update
## Diabetes          0          1
##        0 0.48389218 0.27087442
##        1 0.09598948 0.14924392</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.3</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> Diabetes  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ Diabetes, family = &quot;binomial&quot;, data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.3697  -0.9429  -0.9429   1.4316   1.4316  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -0.58021    0.06153   -9.43   &lt;2e-16 ***
## Diabetes     1.02155    0.12264    8.33   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1998.1  on 1519  degrees of freedom
## AIC: 2002.1
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="x-age" class="section level4">
<h4>X = age</h4>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>mi_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>( <span class="fu">aes</span>( <span class="at">x=</span>Age, <span class="at">fill=</span> <span class="fu">factor</span>(death_update))) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&#39;white&#39;</span>) </span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>mi_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Age) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n=</span> <span class="fu">n</span>() , <span class="at">p_emp =</span> <span class="fu">sum</span>(death_update)<span class="sc">/</span>n, <span class="at">logit_emp =</span> <span class="fu">log</span>(p_emp<span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p_emp)) ) <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Age, <span class="at">y=</span>p_emp, <span class="at">size =</span> n)) <span class="sc">+</span> <span class="fu">geom_point</span>()  <span class="sc">+</span> <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>mi_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Age) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n=</span> <span class="fu">n</span>() , <span class="at">p_emp =</span> <span class="fu">sum</span>(death_update)<span class="sc">/</span>n, <span class="at">logit_emp =</span> <span class="fu">log</span>(p_emp<span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p_emp)) ) <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Age, <span class="at">y=</span>logit_emp, <span class="at">size =</span> n)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-20-3.png" width="672" /></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mi_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Age) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">n=</span> <span class="fu">n</span>() , <span class="at">p_emp =</span> <span class="fu">sum</span>(death_update)<span class="sc">/</span>n, <span class="at">logit_emp =</span> <span class="fu">log</span>(p_emp<span class="sc">/</span> (<span class="dv">1</span><span class="sc">-</span>p_emp)) ) <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Age, <span class="at">y=</span>logit_emp, <span class="at">size =</span> n)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span><span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;glm&#39;</span>, <span class="at">formula =</span> y<span class="sc">~</span><span class="fu">poly</span>(x,<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (stat_smooth).</code></pre>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-20-4.png" width="672" /></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.3</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span>Age  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ Age, family = &quot;binomial&quot;, data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.3853  -1.0358  -0.7141   1.1336   2.1490  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -4.363893   0.398322  -10.96   &lt;2e-16 ***
## Age          0.074466   0.007198   10.35   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1949.2  on 1519  degrees of freedom
## AIC: 1953.2
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>fit.<span class="fl">3.2</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> <span class="fu">poly</span>(Age,<span class="dv">2</span>)  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.<span class="fl">3.2</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ poly(Age, 2), family = &quot;binomial&quot;, 
##     data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.4755  -0.9872  -0.7374   1.1358   1.7604  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -0.34941    0.05454  -6.406 1.49e-10 ***
## poly(Age, 2)1 22.92297    2.24149  10.227  &lt; 2e-16 ***
## poly(Age, 2)2  5.87036    2.23891   2.622  0.00874 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1942.6  on 1518  degrees of freedom
## AIC: 1948.6
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="x-perceivhealth" class="section level4">
<h4>X = PerceivHealth</h4>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(PerceivHealth, death_update))</span></code></pre></div>
<pre><code>##              death_update
## PerceivHealth   0   1
##             1  17  38
##             2  95 139
##             3 173 173
##             4 376 194
##             5 221  95</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">prop.table</span>(<span class="fu">table</span>(PerceivHealth, death_update)))</span></code></pre></div>
<pre><code>##              death_update
## PerceivHealth          0          1
##             1 0.01117686 0.02498356
##             2 0.06245891 0.09138725
##             3 0.11374096 0.11374096
##             4 0.24720579 0.12754767
##             5 0.14529915 0.06245891</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.4</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> <span class="fu">factor</span>(PerceivHealth)  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.4</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ factor(PerceivHealth), family = &quot;binomial&quot;, 
##     data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.5324  -0.9122  -0.8457   1.1774   1.5504  
## 
## Coefficients:
##                        Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)              0.8044     0.2918   2.757  0.00584 ** 
## factor(PerceivHealth)2  -0.4238     0.3207  -1.321  0.18639    
## factor(PerceivHealth)3  -0.8044     0.3110  -2.587  0.00969 ** 
## factor(PerceivHealth)4  -1.4661     0.3049  -4.809 1.52e-06 ***
## factor(PerceivHealth)5  -1.6487     0.3165  -5.209 1.90e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1981.2  on 1516  degrees of freedom
## AIC: 1991.2
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div id="x-health_prob" class="section level4">
<h4>X = Health_Prob</h4>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">table</span>(death_update,  Health_Prob))</span></code></pre></div>
<pre><code>##             Health_Prob
## death_update   0   1   2   3   4   5   6   7   8   9
##            0 189 247 239 106  60  25  10   3   2   1
##            1  78 156 138 127  75  38  18   8   1   0</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> mi_df,  <span class="fu">prop.table</span>(<span class="fu">table</span>(death_update,  Health_Prob)))</span></code></pre></div>
<pre><code>##             Health_Prob
## death_update            0            1            2            3            4
##            0 0.1242603550 0.1623931624 0.1571334648 0.0696909928 0.0394477318
##            1 0.0512820513 0.1025641026 0.0907297830 0.0834976989 0.0493096647
##             Health_Prob
## death_update            5            6            7            8            9
##            0 0.0164365549 0.0065746220 0.0019723866 0.0013149244 0.0006574622
##            1 0.0249835634 0.0118343195 0.0052596976 0.0006574622 0.0000000000</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>mi_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Health_Prob) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>(), </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">p_emp =</span> <span class="fu">sum</span>(death_update)<span class="sc">/</span>n ) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( <span class="at">x=</span><span class="fu">factor</span>(Health_Prob), <span class="at">y=</span> p_emp, <span class="at">size =</span> n)) <span class="sc">+</span> </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># treat health prob as continious</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.5</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> Health_Prob  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.5</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ Health_Prob, family = &quot;binomial&quot;, 
##     data = mi_df)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.808  -1.044  -0.855   1.209   1.539  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -0.81816    0.08759  -9.341  &lt; 2e-16 ***
## Health_Prob  0.24833    0.03469   7.159 8.13e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 2015.8  on 1519  degrees of freedom
## AIC: 2019.8
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># treat health prob as categorical</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.5</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> <span class="fu">factor</span>(Health_Prob)  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.5</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ factor(Health_Prob), family = &quot;binomial&quot;, 
##     data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6120  -0.9895  -0.8313   1.1017   1.5688  
## 
## Coefficients:
##                      Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)           -0.8850     0.1346  -6.576 4.82e-11 ***
## factor(Health_Prob)1   0.4255     0.1690   2.517 0.011823 *  
## factor(Health_Prob)2   0.3358     0.1719   1.954 0.050716 .  
## factor(Health_Prob)3   1.0658     0.1882   5.663 1.49e-08 ***
## factor(Health_Prob)4   1.1082     0.2193   5.052 4.37e-07 ***
## factor(Health_Prob)5   1.3037     0.2906   4.487 7.22e-06 ***
## factor(Health_Prob)6   1.4728     0.4167   3.534 0.000409 ***
## factor(Health_Prob)7   1.8659     0.6902   2.703 0.006868 ** 
## factor(Health_Prob)8   0.1919     1.2321   0.156 0.876237    
## factor(Health_Prob)9 -11.6810   324.7437  -0.036 0.971306    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 2000.2  on 1511  degrees of freedom
## AIC: 2020.2
## 
## Number of Fisher Scoring iterations: 11</code></pre>
<p><strong>Note</strong></p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>mi_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>( Health_Prob) <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>() , <span class="at">p_emp =</span> <span class="fu">sum</span>(death_update)<span class="sc">/</span> n ) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(p_emp)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["Health_Prob"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["p_emp"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"9","2":"1","3":"0.0000000"},{"1":"0","2":"267","3":"0.2921348"},{"1":"8","2":"3","3":"0.3333333"},{"1":"2","2":"377","3":"0.3660477"},{"1":"1","2":"403","3":"0.3870968"},{"1":"3","2":"233","3":"0.5450644"},{"1":"4","2":"135","3":"0.5555556"},{"1":"5","2":"63","3":"0.6031746"},{"1":"6","2":"28","3":"0.6428571"},{"1":"7","2":"11","3":"0.7272727"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Note that we have only one person with Health_Prob = 9 are non-cases. Therefore, when fitting logistic regression, the coefficient for Health_Prob = 9 will be very small and the standard deviation will be very large. (The model will want to predict for these people P = 0 and this happens when <span class="math inline">\(\beta \rightarrow -\infty\)</span>)</p>
</div>
<div id="x-relincome" class="section level4">
<h4>X = RelIncome</h4>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mi_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(RelIncome) <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>(),  <span class="at">p_emp =</span> <span class="fu">sum</span>(death_update)<span class="sc">/</span>n ) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( <span class="at">x=</span><span class="fu">factor</span>(RelIncome), <span class="at">y=</span> p_emp, <span class="at">size =</span> n)) <span class="sc">+</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.6</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> <span class="fu">factor</span>(RelIncome)  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.6</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ factor(RelIncome), family = &quot;binomial&quot;, 
##     data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.2515  -1.0723  -0.7818   1.1051   1.6336  
## 
## Coefficients:
##                    Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)         -0.2523     0.1283  -1.967  0.04915 *  
## factor(RelIncome)1   0.4248     0.1525   2.786  0.00534 ** 
## factor(RelIncome)2  -0.3899     0.1705  -2.287  0.02218 *  
## factor(RelIncome)3  -0.7764     0.1806  -4.299 1.71e-05 ***
## factor(RelIncome)9  -0.3073     0.6398  -0.480  0.63103    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1990.6  on 1516  degrees of freedom
## AIC: 2000.6
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<div id="multiple-vars" class="section level3">
<h3>Multiple vars</h3>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.7</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> Sex <span class="sc">+</span> Age <span class="sc">+</span> Health_Prob <span class="sc">+</span> Diabetes <span class="sc">+</span> <span class="fu">factor</span>(PerceivHealth) <span class="sc">+</span>  formersmoker ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.7</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ Sex + Age + Health_Prob + Diabetes + 
##     factor(PerceivHealth) + formersmoker, family = &quot;binomial&quot;, 
##     data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.0266  -0.9587  -0.6241   1.0668   2.2586  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)            -3.054688   0.526639  -5.800 6.62e-09 ***
## Sex                    -0.191195   0.149330  -1.280 0.200422    
## Age                     0.071717   0.007991   8.975  &lt; 2e-16 ***
## Health_Prob             0.006027   0.042825   0.141 0.888080    
## Diabetes                0.775412   0.142066   5.458 4.81e-08 ***
## factor(PerceivHealth)2 -0.416964   0.340603  -1.224 0.220879    
## factor(PerceivHealth)3 -0.803458   0.332517  -2.416 0.015680 *  
## factor(PerceivHealth)4 -1.347620   0.329136  -4.094 4.23e-05 ***
## factor(PerceivHealth)5 -1.309292   0.343438  -3.812 0.000138 ***
## formersmoker           -0.641611   0.147947  -4.337 1.45e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1832.6  on 1511  degrees of freedom
## AIC: 1852.6
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.8</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> Sex <span class="sc">+</span> Age <span class="sc">+</span> Health_Prob <span class="sc">+</span> Diabetes <span class="sc">+</span> <span class="fu">factor</span>(PerceivHealth) <span class="sc">+</span>  formersmoker </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>            <span class="sc">+</span> <span class="fu">factor</span>(RelIncome) ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ Sex + Age + Health_Prob + Diabetes + 
##     factor(PerceivHealth) + formersmoker + factor(RelIncome), 
##     family = &quot;binomial&quot;, data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.9941  -0.9351  -0.5864   1.0212   2.3592  
## 
## Coefficients:
##                         Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)            -2.712051   0.556338  -4.875 1.09e-06 ***
## Sex                    -0.311698   0.153252  -2.034 0.041962 *  
## Age                     0.067658   0.008067   8.387  &lt; 2e-16 ***
## Health_Prob             0.001197   0.043735   0.027 0.978157    
## Diabetes                0.742239   0.144134   5.150 2.61e-07 ***
## factor(PerceivHealth)2 -0.371494   0.343903  -1.080 0.280040    
## factor(PerceivHealth)3 -0.683772   0.336400  -2.033 0.042091 *  
## factor(PerceivHealth)4 -1.272264   0.333747  -3.812 0.000138 ***
## factor(PerceivHealth)5 -1.159829   0.347533  -3.337 0.000846 ***
## formersmoker           -0.567276   0.151029  -3.756 0.000173 ***
## factor(RelIncome)1      0.295575   0.166561   1.775 0.075967 .  
## factor(RelIncome)2     -0.347321   0.186582  -1.861 0.062675 .  
## factor(RelIncome)3     -0.563145   0.195671  -2.878 0.004002 ** 
## factor(RelIncome)9      0.181679   0.702534   0.259 0.795939    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1797.6  on 1507  degrees of freedom
## AIC: 1825.6
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.9</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> Sex <span class="sc">+</span> Age <span class="sc">+</span> <span class="fu">factor</span>( Health_Prob) <span class="sc">+</span> Diabetes <span class="sc">+</span> <span class="fu">factor</span>(PerceivHealth) <span class="sc">+</span>  formersmoker </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>             <span class="sc">+</span>  <span class="fu">factor</span>(RelIncome) ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.9</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ Sex + Age + factor(Health_Prob) + 
##     Diabetes + factor(PerceivHealth) + formersmoker + factor(RelIncome), 
##     family = &quot;binomial&quot;, data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.1342  -0.9319  -0.5776   1.0356   2.3348  
## 
## Coefficients:
##                          Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)             -2.615223   0.571701  -4.574 4.77e-06 ***
## Sex                     -0.347278   0.154797  -2.243  0.02487 *  
## Age                      0.069415   0.008171   8.495  &lt; 2e-16 ***
## factor(Health_Prob)1     0.067105   0.183258   0.366  0.71423    
## factor(Health_Prob)2    -0.408595   0.195303  -2.092  0.03643 *  
## factor(Health_Prob)3     0.224661   0.217669   1.032  0.30202    
## factor(Health_Prob)4    -0.051823   0.258933  -0.200  0.84137    
## factor(Health_Prob)5     0.066598   0.333632   0.200  0.84178    
## factor(Health_Prob)6     0.046987   0.486620   0.097  0.92308    
## factor(Health_Prob)7     0.118726   0.730335   0.163  0.87086    
## factor(Health_Prob)8    -2.208978   1.320123  -1.673  0.09427 .  
## factor(Health_Prob)9   -11.409119 324.743800  -0.035  0.97197    
## Diabetes                 0.755146   0.145893   5.176 2.27e-07 ***
## factor(PerceivHealth)2  -0.463074   0.357226  -1.296  0.19487    
## factor(PerceivHealth)3  -0.773559   0.350951  -2.204  0.02751 *  
## factor(PerceivHealth)4  -1.386470   0.348017  -3.984 6.78e-05 ***
## factor(PerceivHealth)5  -1.264923   0.360466  -3.509  0.00045 ***
## formersmoker            -0.604766   0.152609  -3.963 7.41e-05 ***
## factor(RelIncome)1       0.311178   0.168386   1.848  0.06460 .  
## factor(RelIncome)2      -0.349743   0.188342  -1.857  0.06332 .  
## factor(RelIncome)3      -0.547952   0.197267  -2.778  0.00547 ** 
## factor(RelIncome)9       0.355632   0.687028   0.518  0.60471    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1779.1  on 1499  degrees of freedom
## AIC: 1823.1
## 
## Number of Fisher Scoring iterations: 11</code></pre>
<p><strong>Interactions:</strong></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.10</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span>  Age<span class="sc">*</span>formersmoker  <span class="sc">+</span> <span class="fu">factor</span>(PerceivHealth) <span class="sc">*</span> Health_Prob  ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.10</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ Age * formersmoker + factor(PerceivHealth) * 
##     Health_Prob, family = &quot;binomial&quot;, data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.8404  -0.9857  -0.6499   1.1156   2.2614  
## 
## Coefficients:
##                                     Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)                        -3.063865   0.732847  -4.181 2.91e-05 ***
## Age                                 0.068065   0.008282   8.218  &lt; 2e-16 ***
## formersmoker                       -1.440022   1.252602  -1.150   0.2503    
## factor(PerceivHealth)2             -0.438622   0.655157  -0.669   0.5032    
## factor(PerceivHealth)3             -0.985757   0.632904  -1.558   0.1193    
## factor(PerceivHealth)4             -1.310592   0.613014  -2.138   0.0325 *  
## factor(PerceivHealth)5             -1.213121   0.622981  -1.947   0.0515 .  
## Health_Prob                         0.075805   0.155941   0.486   0.6269    
## Age:formersmoker                    0.015392   0.021740   0.708   0.4790    
## factor(PerceivHealth)2:Health_Prob  0.013389   0.179346   0.075   0.9405    
## factor(PerceivHealth)3:Health_Prob  0.097590   0.174984   0.558   0.5770    
## factor(PerceivHealth)4:Health_Prob -0.006119   0.168186  -0.036   0.9710    
## factor(PerceivHealth)5:Health_Prob -0.073316   0.184523  -0.397   0.6911    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1861.4  on 1508  degrees of freedom
## AIC: 1887.4
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>fit<span class="fl">.11</span> <span class="ot">=</span>  <span class="fu">glm</span>(death_update <span class="sc">~</span> Sex <span class="sc">+</span> Age <span class="sc">*</span> <span class="fu">factor</span>(RelIncome) <span class="sc">*</span> Health_Prob ,<span class="at">data =</span>mi_df ,<span class="at">family =</span> <span class="st">&#39;binomial&#39;</span>)</span></code></pre></div>
<pre><code>## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="fl">.11</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = death_update ~ Sex + Age * factor(RelIncome) * 
##     Health_Prob, family = &quot;binomial&quot;, data = mi_df)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.8459  -0.9502  -0.6816   1.0805   1.9861  
## 
## Coefficients:
##                                      Estimate Std. Error z value Pr(&gt;|z|)  
## (Intercept)                        -3.110e+00  1.404e+00  -2.215   0.0268 *
## Sex                                -1.504e-01  1.476e-01  -1.019   0.3083  
## Age                                 4.840e-02  2.575e-02   1.880   0.0601 .
## factor(RelIncome)1                 -1.292e+00  1.780e+00  -0.726   0.4679  
## factor(RelIncome)2                  1.010e+00  1.915e+00   0.527   0.5980  
## factor(RelIncome)3                 -2.144e-01  1.908e+00  -0.112   0.9105  
## factor(RelIncome)9                  1.282e+01  1.682e+01   0.762   0.4462  
## Health_Prob                         1.121e-01  7.110e-01   0.158   0.8748  
## Age:factor(RelIncome)1              2.960e-02  3.258e-02   0.909   0.3635  
## Age:factor(RelIncome)2             -2.264e-02  3.568e-02  -0.635   0.5256  
## Age:factor(RelIncome)3             -2.168e-03  3.566e-02  -0.061   0.9515  
## Age:factor(RelIncome)9             -2.500e-01  3.408e-01  -0.734   0.4633  
## Age:Health_Prob                     1.450e-03  1.249e-02   0.116   0.9076  
## factor(RelIncome)1:Health_Prob      4.471e-02  8.488e-01   0.053   0.9580  
## factor(RelIncome)2:Health_Prob     -7.473e-01  9.447e-01  -0.791   0.4289  
## factor(RelIncome)3:Health_Prob     -1.598e-01  9.284e-01  -0.172   0.8634  
## factor(RelIncome)9:Health_Prob     -2.787e+01  2.014e+01  -1.384   0.1664  
## Age:factor(RelIncome)1:Health_Prob -5.287e-04  1.497e-02  -0.035   0.9718  
## Age:factor(RelIncome)2:Health_Prob  1.290e-02  1.692e-02   0.763   0.4457  
## Age:factor(RelIncome)3:Health_Prob -2.574e-04  1.661e-02  -0.015   0.9876  
## Age:factor(RelIncome)9:Health_Prob  5.615e-01  4.094e-01   1.372   0.1702  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2069.6  on 1520  degrees of freedom
## Residual deviance: 1861.6  on 1500  degrees of freedom
## AIC: 1903.6
## 
## Number of Fisher Scoring iterations: 8</code></pre>
</div>
</div>
</div>
<div id="dataset" class="section level1">
<h1>???? Dataset</h1>
<p><span style="color: red;">Daniel - Do we need another example? It seems to me that with the previous data it is possible to produce enough examples… </span></p>
</div>
<div id="logistic-regression-for-classification" class="section level1">
<h1>Logistic Regression for classification</h1>
<div id="default-of-credit-card-clients-data-set" class="section level2">
<h2><strong>Default of credit card clients Data Set</strong></h2>
<p>Source: <a href="https://archive.ics.uci.edu/ml/datasets/default+of+credit+card+clients#" class="uri">https://archive.ics.uci.edu/ml/datasets/default+of+credit+card+clients#</a></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>default_df <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">&quot;datasets/default_credit_card.csv&quot;</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>default_df <span class="ot">=</span> default_df <span class="sc">%&gt;%</span> <span class="fu">rename_all</span>(janitor<span class="sc">::</span>make_clean_names)</span></code></pre></div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>( default_df)</span></code></pre></div>
<pre><code>## Classes &#39;spec_tbl_df&#39;, &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 30000 obs. of  25 variables:
##  $ id                        : num  1 2 3 4 5 6 7 8 9 10 ...
##  $ limit_bal                 : num  20000 120000 90000 50000 50000 50000 500000 100000 140000 20000 ...
##  $ sex                       : num  2 2 2 2 1 1 1 2 2 1 ...
##  $ education                 : num  2 2 2 2 2 1 1 2 3 3 ...
##  $ marriage                  : num  1 2 2 1 1 2 2 2 1 2 ...
##  $ age                       : num  24 26 34 37 57 37 29 23 28 35 ...
##  $ pay_0                     : num  2 -1 0 0 -1 0 0 0 0 -2 ...
##  $ pay_2                     : num  2 2 0 0 0 0 0 -1 0 -2 ...
##  $ pay_3                     : num  -1 0 0 0 -1 0 0 -1 2 -2 ...
##  $ pay_4                     : num  -1 0 0 0 0 0 0 0 0 -2 ...
##  $ pay_5                     : num  -2 0 0 0 0 0 0 0 0 -1 ...
##  $ pay_6                     : num  -2 2 0 0 0 0 0 -1 0 -1 ...
##  $ bill_amt1                 : num  3913 2682 29239 46990 8617 ...
##  $ bill_amt2                 : num  3102 1725 14027 48233 5670 ...
##  $ bill_amt3                 : num  689 2682 13559 49291 35835 ...
##  $ bill_amt4                 : num  0 3272 14331 28314 20940 ...
##  $ bill_amt5                 : num  0 3455 14948 28959 19146 ...
##  $ bill_amt6                 : num  0 3261 15549 29547 19131 ...
##  $ pay_amt1                  : num  0 0 1518 2000 2000 ...
##  $ pay_amt2                  : num  689 1000 1500 2019 36681 ...
##  $ pay_amt3                  : num  0 1000 1000 1200 10000 657 38000 0 432 0 ...
##  $ pay_amt4                  : num  0 1000 1000 1100 9000 ...
##  $ pay_amt5                  : num  0 0 1000 1069 689 ...
##  $ pay_amt6                  : num  0 2000 5000 1000 679 ...
##  $ default_payment_next_month: num  1 1 0 0 0 0 0 0 0 0 ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   ID = col_double(),
##   ..   LIMIT_BAL = col_double(),
##   ..   SEX = col_double(),
##   ..   EDUCATION = col_double(),
##   ..   MARRIAGE = col_double(),
##   ..   AGE = col_double(),
##   ..   PAY_0 = col_double(),
##   ..   PAY_2 = col_double(),
##   ..   PAY_3 = col_double(),
##   ..   PAY_4 = col_double(),
##   ..   PAY_5 = col_double(),
##   ..   PAY_6 = col_double(),
##   ..   BILL_AMT1 = col_double(),
##   ..   BILL_AMT2 = col_double(),
##   ..   BILL_AMT3 = col_double(),
##   ..   BILL_AMT4 = col_double(),
##   ..   BILL_AMT5 = col_double(),
##   ..   BILL_AMT6 = col_double(),
##   ..   PAY_AMT1 = col_double(),
##   ..   PAY_AMT2 = col_double(),
##   ..   PAY_AMT3 = col_double(),
##   ..   PAY_AMT4 = col_double(),
##   ..   PAY_AMT5 = col_double(),
##   ..   PAY_AMT6 = col_double(),
##   ..   `default payment next month` = col_double()
##   .. )</code></pre>
<p><strong>Attribute Information:</strong></p>
<p>This research employed a binary variable, default payment (Yes = 1, No = 0), as the response variable. This study reviewed the literature and used the following 23 variables as explanatory variables:</p>
<ul>
<li><code>limit_bal</code>: Amount of the given credit (NT dollar): it includes both the individual consumer credit and his/her family (supplementary) credit.</li>
<li><code>sex</code> : Gender (1 = male; 2 = female).</li>
<li><code>education</code> : Education (1 = graduate school; 2 = university; 3 = high school; 4 = others).</li>
<li><code>marriage</code>: Marital status (1 = married; 2 = single; 3 = others).</li>
<li><code>age</code> : Age (year).</li>
<li><code>pay_0</code>-<code>pay_6</code> : History of past payment. We tracked the past monthly payment records (from April to September, 2005) as follows: <code>pay_0</code> = the repayment status in September, 2005; <code>pay_2</code> = the repayment status in August, 2005; . . .;<code>pay_6</code> = the repayment status in April, 2005. The measurement scale for the repayment status is: -1 = pay duly; 1 = payment delay for one month; 2 = payment delay for two months; . . .; 8 = payment delay for eight months; 9 = payment delay for nine months and above. <code>bill_amt1</code> -<code>bill_amt6</code> : Amount of bill statement (NT dollar). <code>bill_amt1</code> = amount of bill statement in September, 2005; <code>bill_amt2</code> = amount of bill statement in August, 2005; . . .; <code>bill_amt6</code>= amount of bill statement in April, 2005. <code>pay_amt1</code> -<code>pay_amt6</code> : Amount of previous payment (NT dollar). <code>pay_amt1</code> = amount paid in September, 2005; <code>pay_amt2</code> = amount paid in August, 2005; . . .;<code>pay_amt6</code> = amount paid in April, 2005.</li>
</ul>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> default_df, <span class="fu">table</span>(default_payment_next_month ))</span></code></pre></div>
<pre><code>## default_payment_next_month
##     0     1 
## 23364  6636</code></pre>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span> default_df, <span class="fu">prop.table</span>(<span class="fu">table</span>(default_payment_next_month )))</span></code></pre></div>
<pre><code>## default_payment_next_month
##      0      1 
## 0.7788 0.2212</code></pre>
<p>Note that we can guarantee almost 78% accuracy by classifying all observations to be 0. Of course we do not want to do that, We need to take into account the “costs” of the two types of errors we can make.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">=</span> <span class="fu">cor</span>(default_df <span class="sc">%&gt;%</span> <span class="fu">rename</span>( <span class="st">&quot;y&quot;</span> <span class="ot">=</span> <span class="st">&quot;default_payment_next_month&quot;</span>))</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_mat)</span></code></pre></div>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>default_df <span class="ot">=</span> default_df <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>( sex,education,marriage,pay_0, pay_2, pay_3, pay_4, pay_5, pay_6), factor )</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span>  default_df, <span class="fu">table</span>(sex, default_payment_next_month))</span></code></pre></div>
<pre><code>##    default_payment_next_month
## sex     0     1
##   1  9015  2873
##   2 14349  3763</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="at">data =</span>  default_df, <span class="fu">table</span>(marriage, default_payment_next_month))</span></code></pre></div>
<pre><code>##         default_payment_next_month
## marriage     0     1
##        0    49     5
##        1 10453  3206
##        2 12623  3341
##        3   239    84</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># education: </span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>default_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(education) <span class="sc">%&gt;%</span> <span class="fu">count</span>()</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["education"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"0","2":"14"},{"1":"1","2":"10585"},{"1":"2","2":"14030"},{"1":"3","2":"4917"},{"1":"4","2":"123"},{"1":"5","2":"280"},{"1":"6","2":"51"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s re-encode education = 0 , 5, 6, to  4 (other)</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>default_df <span class="ot">=</span> default_df <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="st">&quot;education&quot;</span>, as.numeric) <span class="sc">%&gt;%</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">education =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>((education<span class="sc">==</span><span class="dv">0</span> )<span class="sc">|</span> (education<span class="sc">&gt;=</span><span class="dv">5</span>) , <span class="dv">4</span>, education))) </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>default_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(education) <span class="sc">%&gt;%</span> </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>(), <span class="at">p_emp =</span> <span class="fu">sum</span>(default_payment_next_month)<span class="sc">/</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>education, <span class="at">y=</span> p_emp, <span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>default_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(education) <span class="sc">%&gt;%</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n=</span><span class="fu">n</span>(), <span class="at">p_emp =</span> <span class="fu">sum</span>(default_payment_next_month)<span class="sc">/</span>n)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["education"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]},{"label":["p_emp"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"14","3":"0.0000000"},{"1":"2","2":"10585","3":"0.1923477"},{"1":"3","2":"14030","3":"0.2373485"},{"1":"4","2":"5371","3":"0.2364550"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># limit ball</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>default_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> limit_bal, <span class="at">fill =</span><span class="fu">factor</span>(default_payment_next_month) )) <span class="sc">+</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&#39;white&#39;</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<p><strong>Train &amp; Test split</strong></p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">31</span>)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>idx_train <span class="ot">=</span> <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(default_df),<span class="at">size =</span> <span class="fl">0.8</span><span class="sc">*</span><span class="fu">round</span>(<span class="fu">nrow</span>(default_df)), <span class="at">replace =</span> F)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> default_df[idx_train, ]</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> default_df[<span class="sc">-</span>idx_train, ]</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(train)</span></code></pre></div>
<pre><code>## [1] 24000    25</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(test)</span></code></pre></div>
<pre><code>## [1] 6000   25</code></pre>
<p><strong>Fitting Logistic Regression</strong></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.1</span> <span class="ot">=</span> <span class="fu">glm</span>(default_payment_next_month <span class="sc">~</span> age<span class="sc">+</span> sex<span class="sc">+</span> limit_bal <span class="sc">+</span> education , <span class="at">data=</span>train, <span class="at">family=</span>binomial)</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.1</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = default_payment_next_month ~ age + sex + limit_bal + 
##     education, family = binomial, data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.0097  -0.7676  -0.6478  -0.4336   2.5621  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.213e+01  9.713e+01  -0.125    0.901    
## age          8.711e-03  1.739e-03   5.010 5.44e-07 ***
## sex2        -1.520e-01  3.211e-02  -4.733 2.21e-06 ***
## limit_bal   -3.354e-06  1.485e-07 -22.594  &lt; 2e-16 ***
## education2   1.113e+01  9.713e+01   0.115    0.909    
## education3   1.121e+01  9.713e+01   0.115    0.908    
## education4   1.110e+01  9.713e+01   0.114    0.909    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 25413  on 23999  degrees of freedom
## Residual deviance: 24720  on 23993  degrees of freedom
## AIC: 24734
## 
## Number of Fisher Scoring iterations: 11</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.2</span> <span class="ot">=</span> <span class="fu">glm</span>(default_payment_next_month <span class="sc">~</span> age<span class="sc">+</span> sex<span class="sc">+</span> limit_bal <span class="sc">+</span> education <span class="sc">+</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>                pay_0 <span class="sc">+</span> pay_2 <span class="sc">+</span> pay_3 <span class="sc">+</span> pay_4 <span class="sc">+</span> pay_5<span class="sc">+</span> pay_6 , <span class="at">data=</span>train, <span class="at">family=</span>binomial)</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.2</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = default_payment_next_month ~ age + sex + limit_bal + 
##     education + pay_0 + pay_2 + pay_3 + pay_4 + pay_5 + pay_6, 
##     family = binomial, data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4746  -0.5898  -0.5061  -0.3835   2.6253  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.354e+01  1.592e+02  -0.085 0.932220    
## age          8.348e-03  1.951e-03   4.279 1.88e-05 ***
## sex2        -1.243e-01  3.589e-02  -3.464 0.000531 ***
## limit_bal   -1.884e-06  1.644e-07 -11.464  &lt; 2e-16 ***
## education2   1.190e+01  1.592e+02   0.075 0.940399    
## education3   1.198e+01  1.592e+02   0.075 0.940011    
## education4   1.183e+01  1.592e+02   0.074 0.940760    
## pay_0-1      6.575e-01  1.202e-01   5.469 4.53e-08 ***
## pay_00      -7.962e-02  1.290e-01  -0.617 0.537259    
## pay_01       9.981e-01  9.385e-02  10.635  &lt; 2e-16 ***
## pay_02       2.251e+00  1.176e-01  19.134  &lt; 2e-16 ***
## pay_03       2.108e+00  1.848e-01  11.411  &lt; 2e-16 ***
## pay_04       2.131e+00  3.452e-01   6.175 6.62e-10 ***
## pay_05       1.617e+00  5.310e-01   3.046 0.002321 ** 
## pay_06       3.568e-01  9.379e-01   0.380 0.703641    
## pay_07      -1.099e+01  5.354e+02  -0.021 0.983630    
## pay_08      -1.194e+01  5.354e+02  -0.022 0.982209    
## pay_2-1     -2.120e-01  1.260e-01  -1.683 0.092421 .  
## pay_20       1.267e-01  1.513e-01   0.837 0.402503    
## pay_21      -9.738e-01  6.400e-01  -1.522 0.128115    
## pay_22       1.031e-01  1.279e-01   0.806 0.420496    
## pay_23       1.585e-01  1.986e-01   0.798 0.425018    
## pay_24      -4.826e-01  3.723e-01  -1.296 0.194867    
## pay_25       1.917e+00  8.434e-01   2.273 0.023043 *  
## pay_26       1.513e+01  5.354e+02   0.028 0.977450    
## pay_27       1.180e+00  6.001e+02   0.002 0.998431    
## pay_28       1.401e+01  6.426e+02   0.022 0.982610    
## pay_3-1     -8.963e-02  1.200e-01  -0.747 0.455086    
## pay_30       7.009e-02  1.366e-01   0.513 0.607847    
## pay_31      -1.134e+01  5.354e+02  -0.021 0.983099    
## pay_32       4.649e-01  1.392e-01   3.340 0.000837 ***
## pay_33       4.580e-01  2.517e-01   1.819 0.068838 .  
## pay_34      -7.425e-01  5.421e-01  -1.370 0.170809    
## pay_35      -1.759e+00  1.240e+00  -1.418 0.156126    
## pay_36       1.384e+01  2.711e+02   0.051 0.959283    
## pay_37      -4.122e-01  8.812e-01  -0.468 0.640001    
## pay_38      -1.444e+00  1.878e+00  -0.769 0.441952    
## pay_4-1     -9.986e-02  1.208e-01  -0.827 0.408264    
## pay_40      -9.604e-02  1.333e-01  -0.720 0.471239    
## pay_41       1.342e+01  5.354e+02   0.025 0.980005    
## pay_42       1.484e-01  1.436e-01   1.033 0.301449    
## pay_43      -1.722e-02  2.769e-01  -0.062 0.950421    
## pay_44       5.109e-01  5.041e-01   1.013 0.310879    
## pay_45      -2.238e+00  9.321e-01  -2.401 0.016347 *  
## pay_46      -2.816e+01  3.553e+02  -0.079 0.936832    
## pay_47      -2.373e+01  3.945e+02  -0.060 0.952032    
## pay_48      -3.947e+01  6.651e+02  -0.059 0.952671    
## pay_5-1     -1.034e-01  1.179e-01  -0.877 0.380358    
## pay_50      -1.679e-02  1.301e-01  -0.129 0.897319    
## pay_52       2.806e-01  1.463e-01   1.918 0.055141 .  
## pay_53      -1.092e-02  2.662e-01  -0.041 0.967275    
## pay_54       4.886e-01  5.628e-01   0.868 0.385296    
## pay_55       1.765e+00  1.049e+00   1.683 0.092310 .  
## pay_56       2.631e+01  3.945e+02   0.067 0.946822    
## pay_57       2.549e+01  3.945e+02   0.065 0.948479    
## pay_58       3.645e+01  1.182e+03   0.031 0.975408    
## pay_6-1     -2.017e-01  8.939e-02  -2.256 0.024042 *  
## pay_60      -3.754e-01  9.508e-02  -3.948 7.87e-05 ***
## pay_62      -2.121e-02  1.115e-01  -0.190 0.849133    
## pay_63       5.958e-01  2.663e-01   2.237 0.025262 *  
## pay_64      -5.650e-02  5.371e-01  -0.105 0.916212    
## pay_65      -1.707e+00  1.341e+00  -1.273 0.203078    
## pay_66      -3.205e-01  1.222e+00  -0.262 0.793130    
## pay_67      -1.078e+00  1.954e+00  -0.551 0.581379    
## pay_68       1.698e+01  6.805e+02   0.025 0.980087    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 25413  on 23999  degrees of freedom
## Residual deviance: 20967  on 23935  degrees of freedom
## AIC: 21097
## 
## Number of Fisher Scoring iterations: 12</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>model<span class="fl">.3</span> <span class="ot">=</span> <span class="fu">glm</span>(default_payment_next_month <span class="sc">~</span> age<span class="sc">+</span> sex<span class="sc">+</span> limit_bal <span class="sc">+</span> education <span class="sc">+</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>                pay_0 <span class="sc">+</span> pay_2 <span class="sc">+</span> pay_3 <span class="sc">+</span> pay_4 <span class="sc">+</span> pay_5<span class="sc">+</span> pay_6 </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>              <span class="sc">+</span> bill_amt1 <span class="sc">+</span> bill_amt2 <span class="sc">+</span> bill_amt3<span class="sc">+</span> bill_amt4 <span class="sc">+</span>bill_amt5 <span class="sc">+</span>bill_amt6 , <span class="at">data=</span>train, <span class="at">family=</span>binomial)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = default_payment_next_month ~ age + sex + limit_bal + 
##     education + pay_0 + pay_2 + pay_3 + pay_4 + pay_5 + pay_6 + 
##     bill_amt1 + bill_amt2 + bill_amt3 + bill_amt4 + bill_amt5 + 
##     bill_amt6, family = binomial, data = train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4782  -0.5908  -0.5053  -0.3740   2.7071  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.345e+01  1.590e+02  -0.085 0.932580    
## age          8.109e-03  1.951e-03   4.156 3.24e-05 ***
## sex2        -1.214e-01  3.593e-02  -3.379 0.000727 ***
## limit_bal   -2.242e-06  1.922e-07 -11.668  &lt; 2e-16 ***
## education2   1.189e+01  1.590e+02   0.075 0.940368    
## education3   1.197e+01  1.590e+02   0.075 0.939998    
## education4   1.181e+01  1.590e+02   0.074 0.940756    
## pay_0-1      6.709e-01  1.207e-01   5.558 2.72e-08 ***
## pay_00      -1.065e-01  1.296e-01  -0.822 0.411081    
## pay_01       9.921e-01  9.406e-02  10.547  &lt; 2e-16 ***
## pay_02       2.220e+00  1.181e-01  18.799  &lt; 2e-16 ***
## pay_03       2.094e+00  1.849e-01  11.325  &lt; 2e-16 ***
## pay_04       2.073e+00  3.444e-01   6.019 1.76e-09 ***
## pay_05       1.564e+00  5.290e-01   2.957 0.003109 ** 
## pay_06       3.387e-01  9.404e-01   0.360 0.718676    
## pay_07      -1.114e+01  5.354e+02  -0.021 0.983402    
## pay_08      -1.203e+01  5.354e+02  -0.022 0.982071    
## pay_2-1     -2.305e-01  1.266e-01  -1.821 0.068640 .  
## pay_20       7.123e-02  1.530e-01   0.466 0.641534    
## pay_21      -1.062e+00  6.441e-01  -1.649 0.099231 .  
## pay_22       3.974e-02  1.301e-01   0.306 0.759971    
## pay_23       9.252e-02  2.005e-01   0.461 0.644442    
## pay_24      -5.577e-01  3.735e-01  -1.493 0.135381    
## pay_25       1.814e+00  8.442e-01   2.149 0.031638 *  
## pay_26       1.506e+01  5.354e+02   0.028 0.977562    
## pay_27       1.106e+00  6.006e+02   0.002 0.998531    
## pay_28       1.383e+01  6.431e+02   0.022 0.982845    
## pay_3-1     -8.506e-02  1.203e-01  -0.707 0.479517    
## pay_30       4.234e-02  1.382e-01   0.306 0.759267    
## pay_31      -1.118e+01  5.354e+02  -0.021 0.983347    
## pay_32       4.518e-01  1.408e-01   3.209 0.001334 ** 
## pay_33       4.443e-01  2.529e-01   1.757 0.078906 .  
## pay_34      -7.709e-01  5.394e-01  -1.429 0.152909    
## pay_35      -1.776e+00  1.239e+00  -1.434 0.151682    
## pay_36       1.380e+01  2.720e+02   0.051 0.959554    
## pay_37      -3.840e-01  8.807e-01  -0.436 0.662803    
## pay_38      -1.401e+00  1.872e+00  -0.748 0.454168    
## pay_4-1     -1.039e-01  1.210e-01  -0.859 0.390169    
## pay_40      -1.157e-01  1.347e-01  -0.859 0.390354    
## pay_41       1.314e+01  5.354e+02   0.025 0.980414    
## pay_42       1.378e-01  1.449e-01   0.951 0.341725    
## pay_43      -3.116e-02  2.779e-01  -0.112 0.910726    
## pay_44       5.098e-01  5.042e-01   1.011 0.311997    
## pay_45      -2.221e+00  9.325e-01  -2.382 0.017206 *  
## pay_46      -2.813e+01  3.562e+02  -0.079 0.937057    
## pay_47      -2.392e+01  3.941e+02  -0.061 0.951601    
## pay_48      -3.962e+01  6.648e+02  -0.060 0.952476    
## pay_5-1     -9.306e-02  1.181e-01  -0.788 0.430645    
## pay_50      -8.706e-03  1.313e-01  -0.066 0.947115    
## pay_52       2.947e-01  1.476e-01   1.997 0.045832 *  
## pay_53       1.253e-02  2.669e-01   0.047 0.962546    
## pay_54       4.873e-01  5.636e-01   0.865 0.387312    
## pay_55       1.781e+00  1.048e+00   1.700 0.089210 .  
## pay_56       2.641e+01  3.941e+02   0.067 0.946570    
## pay_57       2.573e+01  3.941e+02   0.065 0.947948    
## pay_58       3.692e+01  1.182e+03   0.031 0.975080    
## pay_6-1     -2.007e-01  8.959e-02  -2.240 0.025100 *  
## pay_60      -3.866e-01  9.705e-02  -3.983 6.80e-05 ***
## pay_62      -2.124e-02  1.137e-01  -0.187 0.851860    
## pay_63       6.137e-01  2.675e-01   2.294 0.021774 *  
## pay_64      -3.652e-02  5.374e-01  -0.068 0.945811    
## pay_65      -1.698e+00  1.344e+00  -1.264 0.206397    
## pay_66      -3.784e-01  1.255e+00  -0.302 0.762936    
## pay_67      -1.090e+00  1.965e+00  -0.554 0.579239    
## pay_68       1.665e+01  6.805e+02   0.024 0.980478    
## bill_amt1    1.261e-06  8.953e-07   1.409 0.158923    
## bill_amt2    5.780e-07  1.140e-06   0.507 0.612253    
## bill_amt3    2.577e-07  9.969e-07   0.258 0.796050    
## bill_amt4   -3.543e-07  1.135e-06  -0.312 0.754900    
## bill_amt5   -4.321e-07  1.293e-06  -0.334 0.738189    
## bill_amt6   -9.270e-08  1.028e-06  -0.090 0.928184    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 25413  on 23999  degrees of freedom
## Residual deviance: 20948  on 23929  degrees of freedom
## AIC: 21090
## 
## Number of Fisher Scoring iterations: 12</code></pre>
<p><strong>Predicting</strong></p>
<p>Note: our dataset is <strong>unbalanced</strong> so a suitable threshold must be chosen. For example, a threshold = 0.25:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lets choose model.2 for prediction:</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>predicted_prob_train <span class="ot">=</span> <span class="fu">predict</span>(model<span class="fl">.2</span>, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>predictd_y_value_train <span class="ot">=</span> <span class="fu">ifelse</span>(predicted_prob_train <span class="sc">&gt;</span> <span class="fl">0.25</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix train</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="st">&quot;Predicted&quot;</span> <span class="ot">=</span> predictd_y_value_train, <span class="st">&quot;Actual&quot;</span> <span class="ot">=</span> train<span class="sc">$</span>default_payment_next_month)</span></code></pre></div>
<pre><code>##          Actual
## Predicted     0     1
##         0 16136  2436
##         1  2536  2892</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>predicted_prob_test <span class="ot">=</span> <span class="fu">predict</span>(model<span class="fl">.2</span>, <span class="at">newdata =</span> test,  <span class="at">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>predictd_y_value_test <span class="ot">=</span> <span class="fu">ifelse</span>(predicted_prob_test <span class="sc">&gt;</span> <span class="fl">0.25</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix test</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="st">&quot;Predicted&quot;</span> <span class="ot">=</span> predictd_y_value_test, <span class="st">&quot;Actual&quot;</span> <span class="ot">=</span> test<span class="sc">$</span>default_payment_next_month)</span></code></pre></div>
<pre><code>##          Actual
## Predicted    0    1
##         0 4010  601
##         1  682  707</code></pre>
<p><strong>ROC curve</strong></p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co"># train roc</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">prediction</span>(predicted_prob_train, train<span class="sc">$</span>default_payment_next_month)</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>perf <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred,<span class="st">&quot;tpr&quot;</span>,<span class="st">&quot;fpr&quot;</span>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf,<span class="at">colorize=</span><span class="cn">TRUE</span>)</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="co"># test roc</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>pred_test <span class="ot">&lt;-</span> <span class="fu">prediction</span>(predicted_prob_test, test<span class="sc">$</span>default_payment_next_month)</span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>perf_test <span class="ot">&lt;-</span> <span class="fu">performance</span>(pred,<span class="st">&quot;tpr&quot;</span>,<span class="st">&quot;fpr&quot;</span>)</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(perf_test,<span class="at">colorize=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="logistic_reg_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>cutoffs <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(test<span class="sc">$</span>default_payment_next_month, predicted_prob_test)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">coords</span>(roc_obj, <span class="at">x =</span> cutoffs,</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">ret =</span> <span class="fu">c</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="st">&quot;recall&quot;</span>, <span class="st">&quot;precision&quot;</span>,</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;npv&quot;</span>),</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">transpose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(res) <span class="ot">=</span> cutoffs</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>res</span></code></pre></div>
<pre><code>##                   0.1       0.2       0.3       0.4       0.5       0.6
## accuracy    0.3476667 0.7558333 0.8028333 0.8210000 0.8221667 0.8163333
## recall      0.9441896 0.6085627 0.4770642 0.4059633 0.3516820 0.2737003
## precision   0.2433018 0.4551172 0.5556545 0.6413043 0.6774669 0.7019608
## specificity 0.1813725 0.7968883 0.8936488 0.9367008 0.9533248 0.9676044
## npv         0.9209957 0.8795578 0.8597498 0.8497680 0.8406315 0.8269581
##                   0.7       0.8         0.9
## accuracy    0.8083333 0.7976667 0.782666667
## recall      0.1796636 0.1009174 0.005351682
## precision   0.7532051 0.7764706 0.700000000
## specificity 0.9835891 0.9919011 0.999360614
## npv         0.8113572 0.7982847 0.782804674</code></pre>
<p><span style="color: red;">Daniel: Anything else here? regularization??? </span></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
